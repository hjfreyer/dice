<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <script>
      var host = "hjfreyer.github.io";
      if ((host == window.location.host) && (window.location.protocol != "https:"))
      window.location.protocol = "https";
    </script>

    <script src="bower_components/platform/platform.js"></script>
    <script type="text/javascript"
            src="https://apis.google.com/js/api.js"></script>
    <link rel="import" href="bower_components/polymer/polymer.html">
    <link rel="import" href="bower_components/core-ajax/core-ajax.html">
    <link rel="import" href="bower_components/google-signin/google-signin.html">
    <link rel="import" href="dependencies.html">
    <link rel="import" href="header.html">
    <title>Dice Annotator</title>

    <polymer-element name="drive-rpc" attributes="path method response">
      <template>
        <google-signin-aware on-google-signin-aware-success="{{signIn}}"
                             scopes="{{scopes}}">
        </google-signin-aware>
        <core-ajax id="ajax"
                   url="https://www.googleapis.com/drive/v2{{path}}"
                   method="{{method}}"
                   params="{{ {access_token: authToken.access_token} }}"
                   handleAs="json"
                   response="{{response}}">
        </core-ajax>
      </template>
      <script>
        Polymer('drive-rpc', {
          path: '',
          method: 'GET',
          scopes: globals.SCOPES.join(' '),
          authToken: null,
          signIn: function(e) {
            this.authToken = e.detail.result;
          },
          go: function() {
            this.$.ajax.go();
          },
        });
      </script>
    </polymer-element>

    <polymer-element name="folder-overview" attributes="folderId">
      <template>
        <drive-rpc id="list" path="/files/{{folderId}}/children"
                   on-google-signin-aware-success="{{onList}}"></drive-rpc>
      </template>
      <script src="overview.js"></script>
    </polymer-element>

    <polymer-element name="x-overview">
      <template>
        <x-header></x-header>
        <google-signin-aware scopes="{{scopes}}"
                             on-google-signin-aware-success="{{signIn}}">
        </google-signin-aware>

        <template if="{{pickerApi && authToken}}">
          <button on-click="{{pick}}">
            Pick
          </button>
          <template if="{{folderId}}">

            <folder-overview folderId="{{folderId}}"></folder-overview>
          </template>
        </template>
      </template>
      <script src="overview.js"></script>
    </polymer-element>
  </head>
  <body>
    <x-overview></x-overview>
  </body>
</html>
